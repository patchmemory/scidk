{% extends 'base.html' %}
{% block title %}SciDK - Home{% endblock %}
{% block content %}
<section>
  <h2>Scan Files</h2>
  <form action="/scan" method="post">
    <label>Path: <input type="text" name="path" placeholder="/path/to/scan" style="width: 24rem"/></label>
    <label><input type="checkbox" name="recursive" checked/> Recursive</label>
    <button type="submit">Scan</button>
  </form>
</section>

<section>
  <h2>Summary</h2>
  <p class="small">Saved filesystem scans summary (derived from current datasets).</p>
  <ul>
    <li>Total datasets: {{ datasets|length }}</li>
    <li>Unique extensions: {{ by_ext|length }}</li>
  </ul>
  <details>
    <summary class="small">By extension</summary>
    <ul>
      {% for ext, count in by_ext.items() %}
        <li><code>{{ ext or '(none)' }}</code>: {{ count }}</li>
      {% else %}
        <li class="small">No data.</li>
      {% endfor %}
    </ul>
  </details>

  <details open>
    <summary class="small">Last Scan Telemetry</summary>
    {% if telemetry and telemetry.last_scan %}
      <ul>
        <li>Path: <code>{{ telemetry.last_scan.path }}</code></li>
        <li>Recursive: {{ telemetry.last_scan.recursive }}</li>
        <li>Files scanned: {{ telemetry.last_scan.scanned }}</li>
        <li>Duration (sec): {{ '%.4f'|format(telemetry.last_scan.duration_sec) }}</li>
        <li>Started: {{ telemetry.last_scan.started }}</li>
        <li>Ended: {{ telemetry.last_scan.ended }}</li>
      </ul>
    {% else %}
      <p class="small">No scan run yet in this session.</p>
    {% endif %}
  </details>
</section>

<section id="map">
  <h2>Graph Schema Summary</h2>
  <p class="small">MVP placeholder. Shows inferred node counts, relation counts, and interpretation types.</p>
  <ul>
    <li>Nodes: Dataset = {{ schema_summary.nodes.Dataset }}</li>
    <li>Relations:
      <ul>
        {% for rel, cnt in schema_summary.relations.items() %}
          <li>{{ rel }} = {{ cnt }}</li>
        {% else %}
          <li class="small">None</li>
        {% endfor %}
      </ul>
    </li>
    <li>Interpretation types: {{ schema_summary.interpretation_types }}</li>
  </ul>
</section>

<section>
  <h2>Datasets (latest)</h2>
  <table>
    <thead>
    <tr>
      <th>Path</th>
      <th>Extension</th>
      <th>Size (bytes)</th>
      <th>Interpreted</th>
    </tr>
    </thead>
    <tbody>
    {% for d in datasets %}
      <tr>
        <td><a href="/datasets/{{ d.id }}">{{ d.path }}</a></td>
        <td>{{ d.extension }}</td>
        <td class="small">{{ d.size_bytes }}</td>
        <td class="small">{{ d.interpretations.keys()|list }}</td>
      </tr>
    {% else %}
      <tr><td colspan="4" class="small">No datasets yet. Use the Scan form above.</td></tr>
    {% endfor %}
    </tbody>
  </table>
</section>

<section>
  <h2>Workbook Viewer (XLSX)</h2>
  <p class="small">Placeholder: select a .xlsx dataset to preview sheets as tabs in a future iteration.</p>
  <p class="small">Tip: After scanning, go to Files and open an .xlsx dataset. A dedicated viewer will be added.</p>
</section>

<section id="chat">
  <h2>Chat</h2>
  <p class="small">Placeholder for a chat assistant. UI only; backend not wired yet.</p>
  <form onsubmit="event.preventDefault(); alert('Chat backend coming soon');">
    <textarea style="width:100%; height: 5rem" placeholder="Ask something about your datasets..."></textarea>
    <div class="actions">
      <button type="submit">Send</button>
    </div>
  </form>
</section>
{% endblock %}