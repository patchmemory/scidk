{% extends 'base.html' %}
{% block title %}SciDK - Chat{% endblock %}
{% block content %}
<section>
  <h2>Chat</h2>
  <p class="small">Placeholder for a chat assistant. This page will host an interactive assistant.</p>
  <form id="chat-form">
    <textarea id="chat-input" style="width:100%; height: 5rem" placeholder="Ask something about your datasets..."></textarea>
    <div class="actions">
      <button type="submit">Send</button>
    </div>
  </form>
  <div id="chat-history" class="small" style="margin-top:1rem"></div>
</section>
{% endblock %}
{% block head %}
<script>
  window.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('chat-form');
    const input = document.getElementById('chat-input');
    const history = document.getElementById('chat-history');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const message = input.value.trim();
      if (!message) return;
      try {
        const resp = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message })
        });
        const data = await resp.json();
        if (data && data.history) {
          history.innerHTML = data.history.map(m => `<div><strong>${m.role}:</strong> ${m.content}</div>`).join('');
        }
      } catch (err) {
        alert('Chat error: ' + err);
      } finally {
        input.value = '';
        input.focus();
      }
    });
  });
</script>
{% endblock %}
